D:\jdks\jdk-17\bin\java.exe -javaagent:C:\Users\hzz\AppData\Local\Temp\captureAgent38jars\debugger-agent.jar=file:///C:/Users/hzz/AppData/Local/Temp/capture6731152030015481205.props -ea -Didea.test.cyclic.buffer.size=1048576 "-javaagent:D:\jetbrains\intellij idea 2025.1.1.1\lib\idea_rt.jar=53989" -Dkotlinx.coroutines.debug.enable.creation.stack.trace=false -Ddebugger.agent.enable.coroutines=true -Dkotlinx.coroutines.debug.enable.flows.stack.trace=true -Dkotlinx.coroutines.debug.enable.mutable.state.flows.stack.trace=true -Dfile.encoding=UTF-8 -classpath "D:\mavenRspository\org\junit\platform\junit-platform-launcher\1.10.0\junit-platform-launcher-1.10.0.jar;D:\mavenRspository\org\junit\platform\junit-platform-engine\1.10.0\junit-platform-engine-1.10.0.jar;D:\mavenRspository\org\opentest4j\opentest4j\1.3.0\opentest4j-1.3.0.jar;D:\mavenRspository\org\junit\platform\junit-platform-commons\1.10.0\junit-platform-commons-1.10.0.jar;D:\mavenRspository\org\apiguardian\apiguardian-api\1.1.2\apiguardian-api-1.1.2.jar;D:\mavenRspository\org\junit\vintage\junit-vintage-engine\5.10.0\junit-vintage-engine-5.10.0.jar;D:\jetbrains\intellij idea 2025.1.1.1\lib\idea_rt.jar;D:\JetBrains\IntelliJ IDEA 2025.1.1.1\plugins\junit\lib\junit5-rt.jar;D:\JetBrains\IntelliJ IDEA 2025.1.1.1\plugins\junit\lib\junit-rt.jar;E:\code\IdeaFiles\JavaEEDesgin\target\test-classes;E:\code\IdeaFiles\JavaEEDesgin\target\classes;C:\Users\hzz\.m2\repository\org\projectlombok\lombok\1.18.38\lombok-1.18.38.jar;C:\Users\hzz\.m2\repository\org\slf4j\slf4j-api\2.0.17\slf4j-api-2.0.17.jar;C:\Users\hzz\.m2\repository\ch\qos\logback\logback-classic\1.5.13\logback-classic-1.5.13.jar;C:\Users\hzz\.m2\repository\ch\qos\logback\logback-core\1.5.13\logback-core-1.5.13.jar;C:\Users\hzz\.m2\repository\jakarta\servlet\jakarta.servlet-api\6.0.0\jakarta.servlet-api-6.0.0.jar;C:\Users\hzz\.m2\repository\com\fasterxml\jackson\core\jackson-databind\2.15.2\jackson-databind-2.15.2.jar;C:\Users\hzz\.m2\repository\com\fasterxml\jackson\core\jackson-annotations\2.15.2\jackson-annotations-2.15.2.jar;C:\Users\hzz\.m2\repository\com\fasterxml\jackson\core\jackson-core\2.15.2\jackson-core-2.15.2.jar;C:\Users\hzz\.m2\repository\com\fasterxml\jackson\dataformat\jackson-dataformat-yaml\2.15.2\jackson-dataformat-yaml-2.15.2.jar;C:\Users\hzz\.m2\repository\org\yaml\snakeyaml\2.0\snakeyaml-2.0.jar;C:\Users\hzz\.m2\repository\org\apache\tomcat\embed\tomcat-embed-core\11.0.6\tomcat-embed-core-11.0.6.jar;C:\Users\hzz\.m2\repository\org\apache\tomcat\tomcat-annotations-api\11.0.6\tomcat-annotations-api-11.0.6.jar;C:\Users\hzz\.m2\repository\org\apache\tomcat\embed\tomcat-embed-jasper\11.0.6\tomcat-embed-jasper-11.0.6.jar;C:\Users\hzz\.m2\repository\org\apache\tomcat\embed\tomcat-embed-el\11.0.6\tomcat-embed-el-11.0.6.jar;C:\Users\hzz\.m2\repository\org\eclipse\jdt\ecj\3.41.0\ecj-3.41.0.jar;C:\Users\hzz\.m2\repository\com\mysql\mysql-connector-j\8.2.0\mysql-connector-j-8.2.0.jar;C:\Users\hzz\.m2\repository\com\google\protobuf\protobuf-java\3.21.9\protobuf-java-3.21.9.jar;C:\Users\hzz\.m2\repository\com\zaxxer\HikariCP\5.0.1\HikariCP-5.0.1.jar;C:\Users\hzz\.m2\repository\dev\langchain4j\langchain4j-ollama\1.0.0-beta3\langchain4j-ollama-1.0.0-beta3.jar;C:\Users\hzz\.m2\repository\dev\langchain4j\langchain4j-core\1.0.0-beta3\langchain4j-core-1.0.0-beta3.jar;C:\Users\hzz\.m2\repository\org\jspecify\jspecify\1.0.0\jspecify-1.0.0.jar;C:\Users\hzz\.m2\repository\dev\langchain4j\langchain4j-http-client-jdk\1.0.0-beta3\langchain4j-http-client-jdk-1.0.0-beta3.jar;C:\Users\hzz\.m2\repository\dev\langchain4j\langchain4j-http-client\1.0.0-beta3\langchain4j-http-client-1.0.0-beta3.jar;C:\Users\hzz\.m2\repository\org\testcontainers\ollama\1.21.0\ollama-1.21.0.jar;C:\Users\hzz\.m2\repository\org\testcontainers\testcontainers\1.21.0\testcontainers-1.21.0.jar;C:\Users\hzz\.m2\repository\junit\junit\4.13.2\junit-4.13.2.jar;C:\Users\hzz\.m2\repository\org\hamcrest\hamcrest-core\1.3\hamcrest-core-1.3.jar;C:\Users\hzz\.m2\repository\org\apache\commons\commons-compress\1.24.0\commons-compress-1.24.0.jar;C:\Users\hzz\.m2\repository\org\rnorth\duct-tape\duct-tape\1.0.8\duct-tape-1.0.8.jar;C:\Users\hzz\.m2\repository\org\jetbrains\annotations\17.0.0\annotations-17.0.0.jar;C:\Users\hzz\.m2\repository\com\github\docker-java\docker-java-api\3.4.2\docker-java-api-3.4.2.jar;C:\Users\hzz\.m2\repository\com\github\docker-java\docker-java-transport-zerodep\3.4.2\docker-java-transport-zerodep-3.4.2.jar;C:\Users\hzz\.m2\repository\com\github\docker-java\docker-java-transport\3.4.2\docker-java-transport-3.4.2.jar;C:\Users\hzz\.m2\repository\net\java\dev\jna\jna\5.13.0\jna-5.13.0.jar;C:\Users\hzz\.m2\repository\org\junit\jupiter\junit-jupiter-api\5.10.0\junit-jupiter-api-5.10.0.jar;C:\Users\hzz\.m2\repository\org\opentest4j\opentest4j\1.3.0\opentest4j-1.3.0.jar;C:\Users\hzz\.m2\repository\org\junit\platform\junit-platform-commons\1.10.0\junit-platform-commons-1.10.0.jar;C:\Users\hzz\.m2\repository\org\apiguardian\apiguardian-api\1.1.2\apiguardian-api-1.1.2.jar;C:\Users\hzz\.m2\repository\org\junit\jupiter\junit-jupiter-engine\5.10.0\junit-jupiter-engine-5.10.0.jar;C:\Users\hzz\.m2\repository\org\junit\platform\junit-platform-engine\1.10.0\junit-platform-engine-1.10.0.jar;C:\Users\hzz\.m2\repository\org\mockito\mockito-core\5.5.0\mockito-core-5.5.0.jar;C:\Users\hzz\.m2\repository\net\bytebuddy\byte-buddy\1.14.6\byte-buddy-1.14.6.jar;C:\Users\hzz\.m2\repository\net\bytebuddy\byte-buddy-agent\1.14.6\byte-buddy-agent-1.14.6.jar;C:\Users\hzz\.m2\repository\org\objenesis\objenesis\3.3\objenesis-3.3.jar;C:\Users\hzz\.m2\repository\org\mockito\mockito-junit-jupiter\5.5.0\mockito-junit-jupiter-5.5.0.jar;C:\Users\hzz\.m2\repository\com\fasterxml\jackson\datatype\jackson-datatype-jsr310\2.15.2\jackson-datatype-jsr310-2.15.2.jar;C:\Users\hzz\.m2\repository\org\springframework\spring-webflux\7.0.0-M3\spring-webflux-7.0.0-M3.jar;C:\Users\hzz\.m2\repository\org\springframework\spring-beans\7.0.0-M3\spring-beans-7.0.0-M3.jar;C:\Users\hzz\.m2\repository\org\springframework\spring-core\7.0.0-M3\spring-core-7.0.0-M3.jar;C:\Users\hzz\.m2\repository\commons-logging\commons-logging\1.3.4\commons-logging-1.3.4.jar;C:\Users\hzz\.m2\repository\org\springframework\spring-web\7.0.0-M3\spring-web-7.0.0-M3.jar;C:\Users\hzz\.m2\repository\io\micrometer\micrometer-observation\1.14.5\micrometer-observation-1.14.5.jar;C:\Users\hzz\.m2\repository\io\micrometer\micrometer-commons\1.14.5\micrometer-commons-1.14.5.jar;C:\Users\hzz\.m2\repository\io\projectreactor\reactor-core\3.8.0-M1\reactor-core-3.8.0-M1.jar;C:\Users\hzz\.m2\repository\org\reactivestreams\reactive-streams\1.0.4\reactive-streams-1.0.4.jar" com.intellij.rt.junit.JUnitStarter -ideVersion5 -junit5 site.arookieofc.transaction.TransactionTest
23:10:45.101 [main] DEBUG com.zaxxer.hikari.HikariConfig -- HikariPool-1 - configuration:
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- allowPoolSuspension.............false
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- autoCommit......................false
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- catalog.........................none
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- connectionInitSql...............none
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- connectionTestQuery.............none
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- connectionTimeout...............30000
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- dataSource......................none
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- dataSourceClassName.............none
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- dataSourceJNDI..................none
23:10:45.110 [main] DEBUG com.zaxxer.hikari.HikariConfig -- dataSourceProperties............{maintainTimeStats=false, password=<masked>, prepStmtCacheSqlLimit=2048, rewriteBatchedStatements=true, elideSetAutoCommits=false, cachePrepStmts=true, cacheResultSetMetadata=true, prepStmtCacheSize=250, useServerPrepStmts=true, useLocalSessionState=true, cacheServerConfiguration=true}
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- driverClassName.................none
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- exceptionOverrideClassName......none
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- healthCheckProperties...........{}
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- healthCheckRegistry.............none
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- idleTimeout.....................600000
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- initializationFailTimeout.......1
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- isolateInternalQueries..........false
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- jdbcUrl.........................jdbc:mysql://127.0.0.1:3306/student?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- keepaliveTime...................0
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- leakDetectionThreshold..........60000
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- maxLifetime.....................1800000
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- maximumPoolSize.................20
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- metricRegistry..................none
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- metricsTrackerFactory...........none
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- minimumIdle.....................5
23:10:45.111 [main] DEBUG com.zaxxer.hikari.HikariConfig -- password........................<masked>
23:10:45.112 [main] DEBUG com.zaxxer.hikari.HikariConfig -- poolName........................"HikariPool-1"
23:10:45.112 [main] DEBUG com.zaxxer.hikari.HikariConfig -- readOnly........................false
23:10:45.112 [main] DEBUG com.zaxxer.hikari.HikariConfig -- registerMbeans..................false
23:10:45.112 [main] DEBUG com.zaxxer.hikari.HikariConfig -- scheduledExecutor...............none
23:10:45.112 [main] DEBUG com.zaxxer.hikari.HikariConfig -- schema..........................none
23:10:45.112 [main] DEBUG com.zaxxer.hikari.HikariConfig -- threadFactory...................internal
23:10:45.112 [main] DEBUG com.zaxxer.hikari.HikariConfig -- transactionIsolation............default
23:10:45.112 [main] DEBUG com.zaxxer.hikari.HikariConfig -- username........................"root"
23:10:45.112 [main] DEBUG com.zaxxer.hikari.HikariConfig -- validationTimeout...............5000
23:10:45.113 [main] INFO com.zaxxer.hikari.HikariDataSource -- HikariPool-1 - Starting...
23:10:45.129 [main] DEBUG com.zaxxer.hikari.util.DriverDataSource -- Loaded driver with class name com.mysql.cj.jdbc.Driver for jdbcUrl=jdbc:mysql://127.0.0.1:3306/student?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
23:10:45.236 [main] INFO com.zaxxer.hikari.pool.HikariPool -- HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81
23:10:45.237 [main] INFO com.zaxxer.hikari.HikariDataSource -- HikariPool-1 - Start completed.
23:10:45.252 [main] DEBUG com.zaxxer.hikari.pool.ProxyConnection -- HikariPool-1 - Executed rollback on connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81 due to dirty commit state on close().
23:10:45.259 [main] DEBUG com.zaxxer.hikari.pool.ProxyConnection -- HikariPool-1 - Executed rollback on connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81 due to dirty commit state on close().
23:10:45.262 [main] DEBUG com.zaxxer.hikari.pool.ProxyConnection -- HikariPool-1 - Executed rollback on connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81 due to dirty commit state on close().

java.lang.reflect.UndeclaredThrowableException
	at jdk.proxy2/jdk.proxy2.$Proxy14.addTeacher(Unknown Source)
	at site.arookieofc.transaction.TransactionTest.testNestedTransaction(TransactionTest.java:120)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
Caused by: java.lang.reflect.InvocationTargetException
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at site.arookieofc.processor.transaction.TransactionInterceptor.invoke(TransactionInterceptor.java:25)
	... 5 more
Caused by: java.lang.RuntimeException: 教师不存在，无法更新
	at site.arookieofc.service.impl.TeacherServiceImpl.updateTeacher(TeacherServiceImpl.java:101)
	at site.arookieofc.transaction.TransactionTest$2.addTeacher(TransactionTest.java:109)
	... 10 more

23:10:45.271 [main] DEBUG com.zaxxer.hikari.pool.ProxyConnection -- HikariPool-1 - Executed rollback on connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81 due to dirty commit state on close().
23:10:45.272 [main] DEBUG com.zaxxer.hikari.pool.ProxyConnection -- HikariPool-1 - Executed rollback on connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81 due to dirty commit state on close().
23:10:45.275 [main] DEBUG com.zaxxer.hikari.pool.ProxyConnection -- HikariPool-1 - Executed rollback on connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81 due to dirty commit state on close().

org.opentest4j.AssertionFailedError: 事务提交后，教师应该存在于数据库中 ==> 
预期:true
实际:false
<点击以查看差异>


	at org.junit.jupiter.api.AssertionFailureBuilder.build(AssertionFailureBuilder.java:151)
	at org.junit.jupiter.api.AssertionFailureBuilder.buildAndThrow(AssertionFailureBuilder.java:132)
	at org.junit.jupiter.api.AssertTrue.failNotTrue(AssertTrue.java:63)
	at org.junit.jupiter.api.AssertTrue.assertTrue(AssertTrue.java:36)
	at org.junit.jupiter.api.Assertions.assertTrue(Assertions.java:210)
	at site.arookieofc.transaction.TransactionTest.testTransactionCommit(TransactionTest.java:54)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)

23:10:45.277 [main] DEBUG com.zaxxer.hikari.pool.ProxyConnection -- HikariPool-1 - Executed rollback on connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81 due to dirty commit state on close().
教师添加成功，即将抛出异常触发回滚
23:10:45.354 [HikariPool-1 housekeeper] DEBUG com.zaxxer.hikari.pool.HikariPool -- HikariPool-1 - Before cleanup stats (total=1, active=0, idle=1, waiting=0)
23:10:45.355 [HikariPool-1 housekeeper] DEBUG com.zaxxer.hikari.pool.HikariPool -- HikariPool-1 - After cleanup  stats (total=1, active=0, idle=1, waiting=0)
23:10:45.357 [HikariPool-1 connection adder] DEBUG com.zaxxer.hikari.pool.HikariPool -- HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@15cde8bb
23:10:45.372 [HikariPool-1 connection adder] DEBUG com.zaxxer.hikari.pool.HikariPool -- HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@f90be8d
23:10:45.385 [HikariPool-1 connection adder] DEBUG com.zaxxer.hikari.pool.HikariPool -- HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@1efa57f2
23:10:45.402 [HikariPool-1 connection adder] DEBUG com.zaxxer.hikari.pool.HikariPool -- HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@6f4c056d
23:10:45.414 [HikariPool-1 connection adder] DEBUG com.zaxxer.hikari.pool.HikariPool -- HikariPool-1 - After adding stats (total=5, active=0, idle=5, waiting=0)
23:10:45.788 [main] DEBUG com.zaxxer.hikari.pool.ProxyConnection -- HikariPool-1 - Executed rollback on connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81 due to dirty commit state on close().
教师是否存在: false
23:10:45.789 [main] DEBUG com.zaxxer.hikari.pool.ProxyConnection -- HikariPool-1 - Executed rollback on connection com.mysql.cj.jdbc.ConnectionImpl@5644dc81 due to dirty commit state on close().

进程已结束，退出代码为 -1
